<h1 class="manpage">sysdbql(7) Manual Page</h1>
<h2>NAME</h2>
<div class="sectionbody">
<p>sysdbql - the SysDB query language</p>
</div>
<div class="sect1">
<h2 id="_synopsis">SYNOPSIS</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content monospaced">
<pre>LIST hosts;</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>FETCH host 'some.host.name';</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>LOOKUP hosts MATCHING attribute.architecture = 'amd64'
             FILTER :age &lt; 5 * :interval;</pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_description">DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph"><p>“System DataBase” (SysDB) is a multi-backend system management and inventory
collection service. It stores system and inventory information about hardware
and software systems. This information is (continuously) collected from
various configurable backends (inventory services, monitoring services, etc.)
and stored in a graph-like hierarchy of generic objects. The store may be
queried through a generic interface independent of the active backends. Object
names are canonicalized before they are added to the store to ensure a
consistent view of your infrastructure.</p></div>
<div class="paragraph"><p>The central object type is a host, which generally represents a physical or
virtual machine or any other type of physical resource. Hosts, in turn, may
reference a list of services which represent any kind of logical resource like
a software system. Both, hosts and services, may reference a list of
attributes which represent further information about the respective host or
service object. For example, attributes may specify static information like a
host&#8217;s architecture or the software version. A host may also reference a list
of metrics which are references to performance data stored about the host.
SysDB supports querying the respective time-series from a backend&#8217;s data
store.</p></div>
<div class="paragraph"><p>The SysDB query language is a human-readable format for describing a request
to retrieve data from a SysDB daemon. It is very remotely similar to the
Standard Query Language (SQL) supported by relational database management
systems (RDBMS) but specialized for SysDB&#8217;s use-case.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_query_commands">QUERY COMMANDS</h2>
<div class="sectionbody">
<div class="paragraph"><p>Each command is terminated by a semicolon. The following commands are
available to retrieve information from SysDB:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>LIST</strong> hosts [<strong>FILTER</strong> <em>&lt;filter_condition&gt;</em>]
</dt>
<dd>
<p>
Retrieve a sorted (by name) list of all hosts currently stored in SysDB. The
return value is a list of hosts where each host specification includes its
name, the timestamp of the last update of the object known to SysDB and an
approximation of the interval with which the host was updated. If a filter
condition is specified, only objects matching that filter will be included in
the reply. See the section "FILTER clause" for more details about how to
specify the search and filter conditions.
</p>
</dd>
<dt class="hdlist1">
<strong>FETCH</strong> host <em>&lt;hostname&gt;</em> [<strong>FILTER</strong> <em>&lt;filter_condition&gt;</em>]
</dt>
<dd>
<p>
Retrieve detailed information about the specified host object. The return
value includes the hostname, a list of services referenced by the host, and a
list of attributes for the host and each service. If the host does not exist,
an error is returned. If a filter condition is specified, only objects
matching that filter will be included in the reply. See the section "FILTER
clause" for more details about how to specify the search and filter
conditions.
</p>
</dd>
<dt class="hdlist1">
<strong>LOOKUP</strong> hosts <strong>MATCHING</strong> <em>&lt;search_condition&gt;</em> [<strong>FILTER</strong> <em>&lt;filter_condition&gt;</em>]
</dt>
<dd>
<p>
Retrieve detailed information about all host objects matching the specified
search condition. The return value is a list of detailed information for each
matching host providing the same details as returned by the <strong>FETCH</strong> command.
If no host matches the search criteria, it&#8217;s not considered an error. Instead,
an empty list is returned. If a filter condition is specified, only objects
matching that filter will be included in the reply. See the sections "MATCHING
clause" and "FILTER clause" for more details about how to specify the search
and filter conditions.
</p>
</dd>
<dt class="hdlist1">
<strong>TIMESERIES</strong> <em>&lt;hostname&gt;</em>.<em>&lt;metric&gt;</em> [START <em>&lt;datetime&gt;</em>] [END <em>&lt;datetime&gt;</em>]
</dt>
<dd>
<p>
Retrieve a time-series for the specified host&#8217;s metric. The data is retrieved
from a backend data-store based on information provided by the respective
query plugin. The return value includes the actual start and end time of the
time-series and one or multiple sequences of time-stamp / value pairs. If the
metric does not exist or if the backend data-store is not supported, an error
is returned.
</p>
</dd>
</dl></div>
<div class="sect2">
<h3 id="_matching_clause">MATCHING clause</h3>
<div class="paragraph"><p>The <strong>MATCHING</strong> clause in a query specifies a boolean expression which is used
to match host objects based on their names, their attributes, or services
referenced by the host. Each <strong>MATCHING</strong> clause may be made up of one or
multiple subexpressions each matching on one criteria. The following
subexpressions are supported by SysDB:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<em>&lt;field&gt;</em> <em>&lt;operator&gt;</em> <em>&lt;value&gt;</em>
</dt>
<dd>
<p>
        Match a named field against the specified value. See below for what fields
        and operators are supported.
</p>
</dd>
<dt class="hdlist1">
<strong>NOT</strong> <em>&lt;subexpression&gt;</em>
</dt>
<dd>
<p>
        Invert the boolean result of the specified subexpression.
</p>
</dd>
<dt class="hdlist1">
<em>&lt;subexpression&gt;</em> <strong>AND</strong> <em>&lt;subexpression&gt;</em>
</dt>
<dt class="hdlist1">
<em>&lt;subexpression&gt;</em> <strong>OR</strong> <em>&lt;subexpression&gt;</em>
</dt>
<dd>
<p>
        Combine multiple subexpressions using logical AND or logical OR.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The following fields may be queried:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>host</strong>
</dt>
<dd>
<p>
        The full name of the host.
</p>
</dd>
<dt class="hdlist1">
<strong>service</strong>
</dt>
<dd>
<p>
        The full service name as referenced by the host.
</p>
</dd>
<dt class="hdlist1">
<strong>attribute</strong>
</dt>
<dd>
<p>
        The full name of a host attribute.
</p>
</dd>
<dt class="hdlist1">
<strong>attribute.</strong><em>&lt;name&gt;</em>
</dt>
<dd>
<p>
        The value of the named host attribute. If an attribute of the specified
        does not exist, each comparison is treated as if the value does not match.
        See the documentation for the <strong>IS NULL</strong> and <strong>IS NOT NULL</strong> operators for
        ways to check if an attribute exists.
</p>
</dd>
</dl></div>
<div class="paragraph"><p><em>&lt;value&gt;</em> may either be a string (when matching by object names) or match the
type of the attribute&#8217;s value (when matching attribute values). Attribute
values may either be a string, integer, decimal number, or a date-time value
(booleans and binary data are not supported by the frontend yet). See the
section "DATA TYPES" for more details about how specify each data-type.</p></div>
<div class="paragraph"><p>When comparing an attribute&#8217;s value using a regular expression matcher, the
value will be cast to a string before doing so. No other casts are supported
at this time.</p></div>
<div class="paragraph"><p>The following operators may be used to match field values:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>=</strong>
</dt>
<dd>
<p>
        Evaluates to true if the field value exactly matches the specified value.
</p>
</dd>
<dt class="hdlist1">
<strong>!=</strong>
</dt>
<dd>
<p>
        Evaluates to true if the field value does not match the exact specified
        value.
</p>
</dd>
<dt class="hdlist1">
<strong>=~</strong>
</dt>
<dd>
<p>
        Evaluates to true if the field value matches the specified regular
        expression. SysDB uses POSIX extended regular expressions.
</p>
</dd>
<dt class="hdlist1">
<strong>!~</strong>
</dt>
<dd>
<p>
        Evalues to true if the field value does not match the specified regular
        expression.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The following operators may be used, in addition, to match attribute values:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>&lt;</strong>, <strong>&lt;=</strong>, <strong>&gt;=</strong>, <strong>&gt;</strong>
</dt>
<dd>
<p>
        Evaluates to true if the attribute value is less than, less than or equal
        to, greater than or equal to or greater than the specified value.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>In addition, a named attribute may be checked for existence using the <strong>IS
NULL</strong> and <strong>IS NOT NULL</strong> operators. An attribute is considered to be <strong>NULL</strong> if
it is not set for a host.</p></div>
</div>
<div class="sect2">
<h3 id="_filter_clause">FILTER clause</h3>
<div class="paragraph"><p>The <strong>FILTER</strong> clause in a query specifies a boolean expression which is used to
filter objects included in the query&#8217;s response. The filter is applied to
hosts, services, and attributes alike and, thus, will usually be based on the
core properties of the stored objects. The basic syntax for filter clauses is
the same as for matching clauses (see the description about subexpressions
above).</p></div>
<div class="paragraph"><p>The following fields (core properties) of stored objects may be queried:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>:last_update</strong>
</dt>
<dd>
<p>
        The timestamp of the last update of the object. This value is based on
        information provided by the queried backend if possible.
</p>
</dd>
<dt class="hdlist1">
<strong>:age</strong>
</dt>
<dd>
<p>
        The amount of time since the last update of the object.
</p>
</dd>
<dt class="hdlist1">
<strong>:interval</strong>
</dt>
<dd>
<p>
        The interval with which the object gets updated. This value is determined
        automatically based on a moving average determined from the update
        timestamps of an object. It depends on the update timestamps as provided
        by the backend (if available) and SysDB&#8217;s query interval.
</p>
</dd>
<dt class="hdlist1">
<strong>:backend</strong>
</dt>
<dd>
<p>
        The name of the backend (plugin) providing the data.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The type of the <strong>last_update</strong>, <strong>age</strong>, and <strong>interval</strong> fields is date-time and
the type of the <strong>backend</strong> field is string. All conditional operators may be
used to compare the date-time fields (but not regular expression or <strong>IS NULL</strong>
operators). The backend field may only be matched by (in)equality. Each object
may be provided by multiple backends. The filter matches if the specified
value matches any of them.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_types">DATA TYPES</h2>
<div class="sectionbody">
<div class="paragraph"><p>The SysDB query language natively supports various data-types. Constants of
all types may be used in any place where a value is expected.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<strong>String constants</strong>
</dt>
<dd>
<p>
        A string constant is an arbitrary sequence of characters enclosed in
        single quotes (<em>'</em>). Single quotes may be included in a string constant by
        specifying two adjacent single quotes.
</p>
</dd>
<dt class="hdlist1">
<strong>Integer constants</strong>
</dt>
<dd>
<p>
        An integer constant may be specified either as a sequence of digits or in
        scientific notation written in the form "<em>a</em> E <em>b</em>" (without spaces) where
        <em>a</em> and <em>b</em> are integers. A leading plus or minus sign specifies the sign
        of the constant.
</p>
</dd>
<dt class="hdlist1">
<strong>Floating-point constants</strong>
</dt>
<dd>
<p>
        A floating-point constant is a sequence of digits containing a decimal
        point. Digits before or after the decimal point (but not both) are
        optional. Floating-point constants may also be specified in scientific
        notation by appending the letter "E" and a positive or negative integer
        exponent. A leading plus or minus sign specifies the sign of the constant.
</p>
</dd>
<dt class="hdlist1">
<strong>Date and time constants</strong>
</dt>
<dd>
<p>
        A date constant may be specified as <em>YYYY-MM-DD</em> and time constants may be
        specified as <em>HH:MM:SS.nnnnnnnnn</em> where seconds and nanoseconds are
        optional.
</p>
</dd>
<dt class="hdlist1">
<strong>Interval constants</strong>
</dt>
<dd>
<p>
        An interval may be specified by one or multiple quantity and unit pairs.
        The quantity may be any integer constant and the unit may be any of the
        following: <strong>Y</strong> (years), <strong>M</strong> (months), <strong>D</strong> (days), <strong>h</strong> (hours), <strong>m</strong>
        (minutes), <strong>s</strong> (seconds), <strong>ms</strong> (milliseconds), <strong>us</strong> (microseconds), or
        <strong>ns</strong> (nanoseconds). Note that years and months are approximations.
</p>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_response_format">RESPONSE FORMAT</h2>
<div class="sectionbody">
<div class="paragraph"><p>The JavaScript Object Notation (JSON) format, as specified in RFC 4627, is
used in all replies from the server. <a href="http://www.ietf.org/rfc/rfc4627.txt">http://www.ietf.org/rfc/rfc4627.txt</a></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_examples">EXAMPLES</h2>
<div class="sectionbody">
<div class="paragraph"><p>The following examples illustrate the use of the commands and what their
replies look like. The replies are pretty-printed to more easily follow them.</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>LIST hosts;
{"hosts":[{
    "name": "host1.example.com",
    "last_update": "2001-02-03 04:05:06 +0700",
    "update_interval": "5m4s"
  },{
    "name": "host2.example.com",
    "last_update": "2001-02-03 04:05:06 +0700",
    "update_interval": "5m4s"
  }]}</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>FETCH host 'host1.example.com';
{
    "name": "host1.example.com",
    "last_update": "2001-02-03 04:05:06 +0700",
    "update_interval": "5m4s",
    "attributes": [{
        "name": "architecture",
        "value": "amd64",
        "last_update": "2001-02-03 04:05:06 +0700",
        "update_interval": "5m4s"
      },{
        ...
      }],
    "services": [{
        "name": "some service",
        "last_update": "2001-02-03 04:05:06 +0700",
        "update_interval": "5m4s"
      },{
        ...
      }]}</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>LOOKUP hosts MATCHING attribute.architecture = 'amd64';
[{
    "name": "host1.example.com",
    "last_update": "2001-02-03 04:05:06 +0700",
    "update_interval": "5m4s",
    "attributes": [{
        "name": "architecture",
        "value": "amd64",
        "last_update": "2001-02-03 04:05:06 +0700",
        "update_interval": "5m4s"
      },{
        ...
      }],
    "services": [{
        "name": "some service",
        "last_update": "2001-02-03 04:05:06 +0700",
        "update_interval": "5m4s"
      },{
        ...
  }]},{
    ...
  }]</pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also">SEE ALSO</h2>
<div class="sectionbody">
<div class="paragraph"><p><a href="sysdb.1.html">sysdb(1)</a>, <a href="sysdb.7.html">sysdb(7)</a></p></div>
<div class="paragraph"><p>The SysDB homepage: <a href="https://sysdb.io/">https://sysdb.io/</a></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_author">AUTHOR</h2>
<div class="sectionbody">
<div class="paragraph"><p>SysDB was written by Sebastian "tokkee" Harl &lt;<a href="mailto:sh@tokkee.org">sh@tokkee.org</a>&gt;.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_copyright">COPYRIGHT</h2>
<div class="sectionbody">
<div class="paragraph"><p>Copyright &#169; 2012-2014 Sebastian "tokkee" Harl &lt;<a href="mailto:sh@tokkee.org">sh@tokkee.org</a>&gt;</p></div>
<div class="paragraph"><p>This is free software under the terms of the BSD license, see the source for
copying conditions. There is NO WARRANTY; not even for MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.</p></div>
</div>
</div>
<hr />
<div id="footer">
<p>
Last updated 2014-09-01 20:48:06 CEST
</p>
</div>
